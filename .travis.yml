os: linux
dist: trusty
sudo: required
language: cpp
compiler: clang

matrix:
  fast_finish: true
  include:
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-6
      before_install:
        - sudo apt-get -qq update
        - sudo apt-get install -y ninja-build llvm ocl-icd-opencl-dev libprotobuf-dev protobuf-compiler libpng-dev
      install:
        - mkdir build && cd build
        - cmake -G Ninja -DGLOW_USE_SANITIZER="Address;Undefined" -DCMAKE_BUILD_TYPE=Debug -DGLOW_WITH_OPENCL=OFF -DGLOW_WITH_JIT=ON ../
    - os: linux
      before_install:
        - sudo apt-get -qq update
        - sudo apt-get install -y ninja-build llvm ocl-icd-opencl-dev libprotobuf-dev protobuf-compiler libpng-dev
      install:
        - mkdir build && cd build
        - cmake -G Ninja -DCMAKE_BUILD_TYPE=Release -DGLOW_WITH_OPENCL=OFF ../

script:
 - ninja all
 - CTEST_PARALLEL_LEVEL=2 ninja test
 - cat Testing/Temporary/LastTest.log
